{{ partial "header.html" . }}

<div id="post">
    {{ $now := now }}
    {{ $currentMonthDay := $now.Format "01-02" }}
    {{ $currentYear := $now.Format "2006" }}
    {{ $thoughtPosts := where .Site.RegularPages "Section" "thoughts" }}
    {{ $onThisDayPosts := slice }}

    {{ range $thoughtPosts }}
        {{ if and (eq (.Date.Format "01-02") $currentMonthDay) (ne (.Date.Format "2006") $currentYear) }}
            {{ $onThisDayPosts = $onThisDayPosts | append . }}
        {{ end }}
    {{ end }}

    <div id="wrapper">
        <article class="norm">
            <h2 id="title">On This Day</h2>
            <p class="thoughts-meta">
                Thoughts from previous years on {{ $now.Format "January 2" }}. {{ len $onThisDayPosts }} memories.
                <a href="{{ "thoughts" | relURL }}">Browse all thoughts</a>
            </p>

            {{ if gt (len $onThisDayPosts) 0 }}
                {{ $sortedPosts := sort $onThisDayPosts "Date" "desc" }}
                {{ $groupedByYear := $sortedPosts.GroupByDate "2006" }}

                {{ range $groupedByYear }}
                    <section class="writeas-section">
                        <h3 class="writeas-section-title">{{ .Key }}</h3>
                        <div class="thoughts-list">
                            {{ range .Pages }}
                            <div class="thought-item">
                                <span class="thought-time">
                                    <a href="{{ .Permalink }}">{{ .Date.Format "Jan 02, 2006 at 3:04 PM" }}</a>
                                </span>
                                <div class="thought-body">
                                    {{ .Content }}
                                </div>
                            </div>
                            {{ end }}
                        </div>
                    </section>
                {{ end }}
            {{ else }}
                <p>No memories from this day yet. Check back tomorrow.</p>
            {{ end }}
        </article>
    </div>
</div>

{{ partial "footer.html" . }}
