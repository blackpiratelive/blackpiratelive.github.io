<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>

    {{ $prefetchHosts := .Site.Params.prefetchHosts }}
    {{ if not $prefetchHosts }}
    {{ $prefetchHosts = slice "//fonts.googleapis.com" "//fonts.gstatic.com" "//cdn.jsdelivr.net"
    "//gallery.blackpiratex.com" }}
    {{ end }}
    {{ range $prefetchHosts }}
    <link rel="dns-prefetch" href="{{ . }}">
    {{ end }}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="prefetch" as="font" type="font/woff2"
        href="https://fonts.gstatic.com/s/lora/v37/0QIvMX1D_JOuMwr7Iw.woff2" crossorigin>
    <link rel="prefetch" as="font" type="font/woff2"
        href="https://fonts.gstatic.com/s/opensans/v44/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-muw.woff2" crossorigin>
    <link rel="preload" as="style"
        href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap">
    {{ $writeasCSS := "css/writeas.css" }}
    <link rel="stylesheet" href="{{ $writeasCSS | relURL }}">
    {{ $latteCSS := "css/catpuccin-latte.css" }}
    <link rel="stylesheet" href="{{ $latteCSS | relURL }}">
    {{ $mochaCSS := "css/catpuccin-mocha.css" }}
    <link rel="stylesheet" href="{{ $mochaCSS | relURL }}">
    {{ if and (eq .Section "blog") (eq .Kind "section") }}
    {{ $blogListCSS := "css/blog-list.css" }}
    <link rel="stylesheet" href="{{ $blogListCSS | relURL }}">
    {{ end }}
    {{ if eq .Section "books" }}
    {{ $booksCSS := "css/books.css" }}
    <link rel="stylesheet" href="{{ $booksCSS | relURL }}">
    {{ end }}
    {{ if .IsHome }}
    {{ $homeCSS := "css/writeas-home.css" }}
    <link rel="stylesheet" href="{{ $homeCSS | relURL }}">
    {{ end }}

    {{ $lucideJS := "js/vendor/lucide.min.js" }}
    <script src="{{ $lucideJS | relURL }}"></script>
    <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
    {{ $searchJS := "js/search.js" }}
    <script src="{{ $searchJS | relURL }}"></script>

    {{/* --- Meta Description --- */}}
    {{ $desc := "" }}
    {{ if .Params.summary }}
    {{ $desc = .Params.summary }}
    {{ else if .IsPage }}
    {{ $desc = .Summary | plainify | truncate 160 }}
    {{ else }}
    {{ $desc = .Site.Title }}
    {{ end }}
    <meta name="description" content="{{ $desc }}">

    {{/* --- Open Graph --- */}}
    <meta property="og:title" content="{{ .Title }}">
    <meta property="og:description" content="{{ $desc }}">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    {{ if .IsPage }}
    <meta property="og:type" content="article">
    {{ else }}
    <meta property="og:type" content="website">
    {{ end }}
    {{ if .Params.cover }}
    {{ $coverImg := resources.Get .Params.cover }}
    {{ if $coverImg }}
    {{ $ogImg := $coverImg.Fill "1200x630 webp q30" }}
    <meta property="og:image" content="{{ $ogImg.Permalink }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    {{ end }}
    {{ end }}

    {{/* --- Twitter Card --- */}}
    {{ if .Params.cover }}
    <meta name="twitter:card" content="summary_large_image">
    {{ else }}
    <meta name="twitter:card" content="summary">
    {{ end }}
    <meta name="twitter:title" content="{{ .Title }}">
    <meta name="twitter:description" content="{{ $desc }}">
    {{ if .Params.cover }}
    {{ $coverImg := resources.Get .Params.cover }}
    {{ if $coverImg }}
    {{ $twImg := $coverImg.Fill "1200x630 webp q30" }}
    <meta name="twitter:image" content="{{ $twImg.Permalink }}">
    {{ end }}
    {{ end }}
</head>

<body id="post">

    <header class="retro-header">
        <nav class="retro-navbar">
            <div class="retro-top">
                <div class="retro-brand">
                    <h1><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h1>
                </div>
                <div class="retro-marquee">
                    <div class="marquee-track">
                        <span class="marquee-content">
                            Welcome to the digital void... //
                            <strong>Latest:</strong> {{ range first 1 (where .Site.RegularPages "Type" "blog") }}{{
                            .Title }}{{ end }} //
                            System Status: <strong>ONLINE</strong> //
                            <span class="cursor-blink">_</span>
                        </span>
                        <!-- Duplicate for seamless scroll -->
                        <span class="marquee-content" aria-hidden="true">
                            Welcome to the digital void... //
                            <strong>Latest:</strong> {{ range first 1 (where .Site.RegularPages "Type" "blog") }}{{
                            .Title }}{{ end }} //
                            System Status: <strong>ONLINE</strong> //
                            <span class="cursor-blink">_</span>
                        </span>
                    </div>
                </div>
                <button class="retro-toggle" type="button" aria-label="Toggle Menu">
                    <span class="toggle-icon">â˜°</span>
                </button>
            </div>
            <div class="retro-links">
                {{ $blog := "blog" }}
                {{ $thoughts := "thoughts" }}
                {{ $gallery := "gallery" }}
                {{ $books := "books" }}
                {{ $stats := "stats" }}
                {{ $otd := "on-this-day" }}
                {{ $search := "search" }}
                <a href="{{ .Site.BaseURL }}" class="retro-btn {{ if .IsHome }}active{{ end }}">Home</a>
                <a href="{{ $blog | relURL }}" class="retro-btn {{ if eq .Section " blog" }}active{{ end }}">Blog</a>
                <a href="{{ $thoughts | relURL }}" class="retro-btn {{ if eq .Section " thoughts" }}active{{ end
                    }}">Thoughts</a>
                <a href="{{ $gallery | relURL }}" class="retro-btn {{ if eq .Section " gallery" }}active{{ end
                    }}">Gallery</a>
                <a href="{{ $books | relURL }}" class="retro-btn {{ if eq .Section " books" }}active{{ end }}">Books</a>
                <a href="{{ $stats | relURL }}" class="retro-btn {{ if eq .Section " stats" }}active{{ end }}">Stats</a>
                <a href="{{ $otd | relURL }}" class="retro-btn {{ if eq .Section " on-this-day" }}active{{ end }}">On
                    This Day</a>
                <a href="{{ $search | relURL }}" class="retro-btn icon-btn">Search</a>
                <button class="retro-btn theme-toggle" type="button">Theme</button>
            </div>
        </nav>
    </header>

    <script>
        // Mobile menu toggle
        document.querySelector('.retro-toggle').addEventListener('click', function () {
            document.querySelector('.retro-links').classList.toggle('open');
        });
    </script>

    <script>
        (function () {
            const storageKey = "bp-theme";
            const root = document.documentElement;
            const toggle = document.querySelector(".theme-toggle");
            const themes = ["light", "dark", "catpuccin-latte", "catpuccin-mocha"];
            const labels = { light: "Dark", dark: "Latte", "catpuccin-latte": "Mocha", "catpuccin-mocha": "Light" };

            const applyTheme = (value) => {
                if (value === "light") {
                    root.removeAttribute("data-theme");
                } else {
                    root.setAttribute("data-theme", value);
                }
                if (toggle) {
                    toggle.textContent = labels[value] || "Theme";
                }
            };

            let theme = localStorage.getItem(storageKey);
            if (!theme && window.matchMedia) {
                theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            }
            applyTheme(theme || "light");

            if (toggle) {
                toggle.addEventListener("click", () => {
                    const current = root.getAttribute("data-theme") || "light";
                    const idx = themes.indexOf(current);
                    const next = themes[(idx + 1) % themes.length];
                    localStorage.setItem(storageKey, next);
                    applyTheme(next);
                });
            }
        })();
    </script>