<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>

    {{ $prefetchHosts := .Site.Params.prefetchHosts }}
    {{ if not $prefetchHosts }}
    {{ $prefetchHosts = slice "//fonts.googleapis.com" "//fonts.gstatic.com" "//cdn.jsdelivr.net"
    "//gallery.blackpiratex.com" }}
    {{ end }}
    {{ range $prefetchHosts }}
    <link rel="dns-prefetch" href="{{ . }}">
    {{ end }}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="prefetch" as="font" type="font/woff2"
        href="https://fonts.gstatic.com/s/lora/v37/0QIvMX1D_JOuMwr7Iw.woff2" crossorigin>
    <link rel="prefetch" as="font" type="font/woff2"
        href="https://fonts.gstatic.com/s/opensans/v44/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-muw.woff2" crossorigin>
    <link rel="preload" as="style"
        href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap">
    {{ $writeasCSS := "css/writeas.css" }}
    <link rel="stylesheet" href="{{ $writeasCSS | relURL }}">
    {{ $latteCSS := "css/catpuccin-latte.css" }}
    <link rel="stylesheet" href="{{ $latteCSS | relURL }}">
    {{ $mochaCSS := "css/catpuccin-mocha.css" }}
    <link rel="stylesheet" href="{{ $mochaCSS | relURL }}">
    {{ if and (eq .Section "blog") (eq .Kind "section") }}
    {{ $blogListCSS := "css/blog-list.css" }}
    <link rel="stylesheet" href="{{ $blogListCSS | relURL }}">
    {{ end }}
    {{ if eq .Section "books" }}
    {{ $booksCSS := "css/books.css" }}
    <link rel="stylesheet" href="{{ $booksCSS | relURL }}">
    {{ end }}
    {{ if .IsHome }}
    {{ $homeCSS := "css/writeas-home.css" }}
    <link rel="stylesheet" href="{{ $homeCSS | relURL }}">
    {{ end }}

    {{ $lucideJS := "js/vendor/lucide.min.js" }}
    <script src="{{ $lucideJS | relURL }}"></script>
    <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
    {{ $searchJS := "js/search.js" }}
    <script src="{{ $searchJS | relURL }}"></script>
</head>

<body id="post">

    <header>
        <h1><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h1>
        <nav>
            {{ $blog := "blog" }}
            {{ $thoughts := "thoughts" }}
            {{ $gallery := "gallery" }}
            {{ $books := "books" }}
            {{ $stats := "stats" }}
            {{ $otd := "on-this-day" }}
            {{ $search := "search" }}
            <a class="home" href="{{ .Site.BaseURL }}">Home</a>
            <a href="{{ $blog | relURL }}">Blog</a>
            <a href="{{ $thoughts | relURL }}">Thoughts</a>
            <a href="{{ $gallery | relURL }}">Gallery</a>
            <a href="{{ $books | relURL }}">Books</a>
            <a href="{{ $stats | relURL }}">Stats</a>
            <a href="{{ $otd | relURL }}">On This Day</a>
            <a href="{{ $search | relURL }}">Search</a>
            <button class="theme-toggle" type="button" aria-pressed="false">Theme</button>
        </nav>
        {{ with .Site.Params.subtitle }}
        <p class="description">{{ . }}</p>
        {{ end }}
    </header>

    <script>
        (function () {
            const storageKey = "bp-theme";
            const root = document.documentElement;
            const toggle = document.querySelector(".theme-toggle");
            const themes = ["light", "dark", "catpuccin-latte", "catpuccin-mocha"];
            const labels = { light: "Dark", dark: "Latte", "catpuccin-latte": "Mocha", "catpuccin-mocha": "Light" };

            const applyTheme = (value) => {
                if (value === "light") {
                    root.removeAttribute("data-theme");
                } else {
                    root.setAttribute("data-theme", value);
                }
                if (toggle) {
                    toggle.textContent = labels[value] || "Theme";
                }
            };

            let theme = localStorage.getItem(storageKey);
            if (!theme && window.matchMedia) {
                theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            }
            applyTheme(theme || "light");

            if (toggle) {
                toggle.addEventListener("click", () => {
                    const current = root.getAttribute("data-theme") || "light";
                    const idx = themes.indexOf(current);
                    const next = themes[(idx + 1) % themes.length];
                    localStorage.setItem(storageKey, next);
                    applyTheme(next);
                });
            }
        })();
    </script>