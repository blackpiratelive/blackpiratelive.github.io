<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>

    {{ $prefetchHosts := .Site.Params.prefetchHosts }}
    {{ if not $prefetchHosts }}
    {{ $prefetchHosts = slice "//fonts.googleapis.com" "//fonts.gstatic.com" "//cdn.jsdelivr.net"
    "//gallery.blackpiratex.com" }}
    {{ end }}
    {{ range $prefetchHosts }}
    <link rel="dns-prefetch" href="{{ . }}">
    {{ end }}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="prefetch" as="font" type="font/woff2"
        href="https://fonts.gstatic.com/s/lora/v37/0QIvMX1D_JOuMwr7Iw.woff2" crossorigin>
    <link rel="prefetch" as="font" type="font/woff2"
        href="https://fonts.gstatic.com/s/opensans/v44/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-muw.woff2" crossorigin>
    <link rel="preload" as="style"
        href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="{{ " css/writeas.css" | relURL }}">
    {{ if and (eq .Section "blog") (eq .Kind "section") }}
    <link rel="stylesheet" href="{{ " css/blog-list.css" | relURL }}">
    {{ end }}
    {{ if eq .Section "books" }}
    <link rel="stylesheet" href="{{ " css/books.css" | relURL }}">
    {{ end }}
    {{ if .IsHome }}
    <link rel="stylesheet" href="{{ " css/writeas-home.css" | relURL }}">
    {{ end }}

    <script src="{{ " js/vendor/lucide.min.js" | relURL }}"></script>
    <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
    <script src="{{ " js/search.js" | relURL }}"></script>
</head>

<body id="post">

    <header>
        <h1><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h1>
        <nav>
            <a class="home" href="{{ .Site.BaseURL }}">Home</a>
            <a href="{{ " blog" | relURL }}">Blog</a>
            <a href="{{ " thoughts" | relURL }}">Thoughts</a>
            <a href="{{ " gallery" | relURL }}">Gallery</a>
            <a href="{{ " books" | relURL }}">Books</a>
            <a href="{{ " stats" | relURL }}">Stats</a>
            <a href="{{ " on-this-day" | relURL }}">On This Day</a>
            <a href="{{ " search" | relURL }}">Search</a>
            <button class="theme-toggle" type="button" aria-pressed="false">Theme</button>
        </nav>
        {{ with .Site.Params.subtitle }}
        <p class="description">{{ . }}</p>
        {{ end }}
    </header>

    <script>
        (function () {
            const storageKey = "bp-theme";
            const root = document.documentElement;
            const toggle = document.querySelector(".theme-toggle");

            const applyTheme = (value) => {
                if (value === "dark") {
                    root.setAttribute("data-theme", "dark");
                } else {
                    root.removeAttribute("data-theme");
                }
                if (toggle) {
                    const pressed = value === "dark";
                    toggle.setAttribute("aria-pressed", pressed ? "true" : "false");
                    const icon = toggle.querySelector("i");
                    if (icon) {
                        icon.setAttribute("data-lucide", pressed ? "sun" : "moon");
                    } else {
                        toggle.textContent = pressed ? "Light" : "Theme";
                    }
                    if (typeof lucide !== "undefined") {
                        lucide.createIcons();
                    }
                }
            };

            let theme = localStorage.getItem(storageKey);
            if (!theme && window.matchMedia) {
                theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            }
            applyTheme(theme || "light");

            if (toggle) {
                toggle.addEventListener("click", () => {
                    const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
                    localStorage.setItem(storageKey, next);
                    applyTheme(next);
                });
            }
        })();
    </script>