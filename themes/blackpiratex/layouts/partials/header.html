<!DOCTYPE html>
<html lang="en">
{{ $isWriteas := or .IsHome (eq .Section "blog") (eq .Section "thoughts") (eq .Section "gallery") (eq .Section "stats") (eq .Layout "stats") (eq .Layout "on-this-day") (eq .Layout "search") (eq .Layout "page") (eq .Section "tags") (eq .Kind "taxonomy") (eq .Kind "taxonomyTerm") (eq .Kind "term") }}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>

    {{ if $isWriteas }}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="{{ "css/writeas.css" | relURL }}">
    {{ if .IsHome }}
    <link rel="stylesheet" href="{{ "css/writeas-home.css" | relURL }}">
    <script src="{{ "js/vendor/lucide.min.js" | relURL }}"></script>
    {{ end }}
    {{ else }}
    <link rel="stylesheet" href="{{ "css/base.css" | relURL }}">

    {{ $styles := slice }}
    {{ if .IsHome }}
        {{ $styles = $styles | append "css/section.css" "css/home.css" }}
    {{ else if eq .Layout "stats" }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/stats.css" }}
    {{ else if eq .Layout "on-this-day" }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/controls.css" "css/on-this-day.css" }}
    {{ else if eq .Layout "sitemap" }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/sitemap.css" }}
    {{ else if eq .Layout "search" }}
        {{ $styles = $styles | append "css/hero.css" "css/search.css" }}
    {{ else if eq .Kind "taxonomyTerm" }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/controls.css" "css/tags.css" }}
    {{ else if or (eq .Kind "taxonomy") (eq .Kind "term") }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/tags.css" "css/blog-list.css" "css/thoughts.css" "css/gallery.css" }}
    {{ else if and (eq .Section "blog") (eq .Kind "section") }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/controls.css" "css/blog-list.css" "css/pagination.css" }}
    {{ else if and (eq .Section "blog") (eq .Kind "page") }}
        {{ $styles = $styles | append "css/section.css" "css/post.css" "css/page.css" }}
    {{ else if and (eq .Section "thoughts") (eq .Kind "section") }}
        {{ $styles = $styles | append "css/thoughts.css" }}
    {{ else if and (eq .Section "thoughts") (eq .Kind "page") }}
        {{ $styles = $styles | append "css/post.css" "css/pagination.css" }}
    {{ else if and (eq .Section "gallery") (eq .Kind "section") }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/gallery.css" }}
    {{ else if and (eq .Section "gallery") (eq .Kind "page") }}
        {{ $styles = $styles | append "css/gallery.css" }}
    {{ else if eq .Layout "page" }}
        {{ $styles = $styles | append "css/section.css" "css/hero.css" "css/page.css" }}
    {{ else if eq .Layout "single" }}
        {{ $styles = $styles | append "css/post.css" }}
    {{ end }}

    {{ range $styles }}
    <link rel="stylesheet" href="{{ . | relURL }}">
    {{ end }}
    
    <script src="{{ "js/vendor/lucide.min.js" | relURL }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
    <script src="{{ "js/search.js" | relURL }}"></script>
    {{ end }}
</head>
<body{{ if $isWriteas }} id="post"{{ end }}>

    {{ if $isWriteas }}
    <header>
        <h1><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h1>
        <nav>
            <a class="home" href="{{ .Site.BaseURL }}">Home</a>
            <a href="{{ "blog" | relURL }}">Blog</a>
            <a href="{{ "thoughts" | relURL }}">Thoughts</a>
            <a href="{{ "gallery" | relURL }}">Gallery</a>
            <a href="{{ "stats" | relURL }}">Stats</a>
            <a href="{{ "on-this-day" | relURL }}">On This Day</a>
            <a href="{{ "search" | relURL }}">Search</a>
            <button class="theme-toggle" type="button" aria-pressed="false">Theme</button>
        </nav>
        {{ with .Site.Params.subtitle }}
        <p class="description">{{ . }}</p>
        {{ end }}
    </header>
    {{ else }}
    <div id="header-container">
        <a href="{{ .Site.BaseURL }}" class="header-title">
            <i data-lucide="pen-tool" style="margin-right: 8px;"></i>
            {{ .Site.Title }}
        </a>
        <div class="header-subtitle">
            {{ .Site.Params.subtitle | default "Notes, thoughts, and code snippets from my daily life." }}
        </div>

        <div class="nav-bar">
            <a class="nav-link" href="{{ .Site.BaseURL }}">
                <i data-lucide="layout-dashboard" width="14"></i> Home
            </a>
            <span class="nav-separator">|</span>
            <a class="nav-link" href="{{ "blog" | relURL }}">
                <i data-lucide="book-open" width="14"></i> Blog
            </a>
            <span class="nav-separator">|</span>
            <a class="nav-link" href="{{ "thoughts" | relURL }}">
                <i data-lucide="brain-circuit" width="14"></i> Thoughts
            </a>
            <span class="nav-separator">|</span>
            <a class="nav-link" href="{{ "gallery" | relURL }}">
                <i data-lucide="image" width="14"></i> Gallery
            </a>
            <span class="nav-separator">|</span>
            <a class="nav-link" href="{{ "stats" | relURL }}">
                <i data-lucide="trending-up" width="14"></i> Stats
            </a>
            <span class="nav-separator">|</span>
            <a class="nav-link" href="{{ "on-this-day" | relURL }}">
                <i data-lucide="calendar-days" width="14"></i> On This Day
            </a>
            <span class="nav-separator">|</span>
            <a class="nav-link" href="{{ "search" | relURL }}">
                <i data-lucide="search" width="14"></i> Search
            </a>
            <span class="nav-separator">|</span>
            <button class="nav-link theme-toggle" type="button" aria-pressed="false">
                <i data-lucide="moon" width="14"></i> Theme
            </button>
        </div>
    </div>
    {{ end }}

    <script>
        (function () {
            const storageKey = "bp-theme";
            const root = document.documentElement;
            const toggle = document.querySelector(".theme-toggle");

            const applyTheme = (value) => {
                if (value === "dark") {
                    root.setAttribute("data-theme", "dark");
                } else {
                    root.removeAttribute("data-theme");
                }
                if (toggle) {
                    const pressed = value === "dark";
                    toggle.setAttribute("aria-pressed", pressed ? "true" : "false");
                    const icon = toggle.querySelector("i");
                    if (icon) {
                        icon.setAttribute("data-lucide", pressed ? "sun" : "moon");
                    } else {
                        toggle.textContent = pressed ? "Light" : "Theme";
                    }
                    if (typeof lucide !== "undefined") {
                        lucide.createIcons();
                    }
                }
            };

            let theme = localStorage.getItem(storageKey);
            if (!theme && window.matchMedia) {
                theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            }
            applyTheme(theme || "light");

            if (toggle) {
                toggle.addEventListener("click", () => {
                    const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
                    localStorage.setItem(storageKey, next);
                    applyTheme(next);
                });
            }
        })();
    </script>
